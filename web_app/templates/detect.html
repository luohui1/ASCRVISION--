<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>智能检测 - ACSR VISION</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@400;500;600;700&family=Rajdhani:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <style>
*{margin:0;padding:0;box-sizing:border-box}
:root{
    --void:#030303;
    --obsidian:#0a0a0a;
    --carbon:#111;
    --graphite:#1a1a1a;
    --steel:#2a2a2a;
    --gold:#d4af37;
    --gold-bright:#f4d03f;
    --gold-dim:rgba(212,175,55,0.12);
    --gold-glow:rgba(212,175,55,0.4);
    --ivory:#f8f6f0;
    --silver:#888;
    --success:#00ff88;
    --danger:#ff4757;
    --scan-line:rgba(212,175,55,0.03);
}
html{font-size:16px}
body{
    font-family:'Rajdhani',sans-serif;
    background:var(--void);
    color:var(--ivory);
    min-height:100vh;
    overflow-x:hidden;
    position:relative;
}
body::before{
    content:'';
    position:fixed;
    inset:0;
    background:
        repeating-linear-gradient(0deg,var(--scan-line) 0px,var(--scan-line) 1px,transparent 1px,transparent 3px),
        radial-gradient(ellipse at 50% 0%,rgba(212,175,55,0.08) 0%,transparent 60%);
    pointer-events:none;
    z-index:0;
}

/* Navigation */
nav{
    position:fixed;top:0;left:0;right:0;z-index:1000;
    background:linear-gradient(180deg,rgba(3,3,3,0.98) 0%,rgba(3,3,3,0.9) 100%);
    backdrop-filter:blur(20px);
    border-bottom:1px solid rgba(212,175,55,0.15);
    padding:0 40px;
    height:64px;
    display:flex;align-items:center;justify-content:space-between;
}
.logo{display:flex;align-items:center;gap:14px;text-decoration:none}
.logo-icon{
    width:42px;height:42px;
    border:1.5px solid var(--gold);
    border-radius:50%;
    display:flex;align-items:center;justify-content:center;
    position:relative;
    transition:all 0.4s cubic-bezier(0.4,0,0.2,1);
}
.logo-icon::before{
    content:'';position:absolute;inset:3px;
    border:1px solid rgba(212,175,55,0.3);
    border-radius:50%;
}
.logo-icon svg{width:18px;height:18px;color:var(--gold)}
.logo:hover .logo-icon{transform:rotate(180deg);box-shadow:0 0 20px var(--gold-glow)}
.logo-text{font-family:'Orbitron',monospace;font-size:1.1rem;font-weight:600;letter-spacing:3px;color:var(--ivory)}
.logo-text span{color:var(--gold)}

.nav-links{display:flex;gap:6px}
.nav-link{
    font-family:'Orbitron',monospace;
    padding:10px 20px;
    font-size:0.7rem;
    letter-spacing:2px;
    text-transform:uppercase;
    text-decoration:none;
    color:var(--silver);
    border:1px solid transparent;
    position:relative;
    transition:all 0.3s;
}
.nav-link::before{
    content:'';position:absolute;bottom:0;left:50%;
    width:0;height:1px;background:var(--gold);
    transition:all 0.3s;transform:translateX(-50%);
}
.nav-link:hover,.nav-link.active{color:var(--gold)}
.nav-link:hover::before,.nav-link.active::before{width:60%}
.nav-link.active{border-color:rgba(212,175,55,0.2);background:var(--gold-dim)}

/* Main Layout */
.main{
    padding:100px 40px 40px;
    max-width:1600px;
    margin:0 auto;
    display:grid;
    grid-template-columns:1fr 1fr;
    gap:30px;
    min-height:100vh;
    position:relative;
    z-index:1;
}
@media(max-width:1200px){.main{grid-template-columns:1fr;padding:90px 20px 20px}}

/* Panel Styling */
.panel{
    background:linear-gradient(145deg,var(--obsidian) 0%,var(--carbon) 100%);
    border:1px solid rgba(212,175,55,0.12);
    position:relative;
    display:flex;flex-direction:column;
}
.panel::before{
    content:'';position:absolute;top:0;left:0;right:0;height:1px;
    background:linear-gradient(90deg,transparent,var(--gold),transparent);
    opacity:0.5;
}
.panel-corner{
    position:absolute;width:20px;height:20px;
    border-color:var(--gold);border-style:solid;border-width:0;
    opacity:0.6;
}
.panel-corner.tl{top:-1px;left:-1px;border-top-width:2px;border-left-width:2px}
.panel-corner.tr{top:-1px;right:-1px;border-top-width:2px;border-right-width:2px}
.panel-corner.bl{bottom:-1px;left:-1px;border-bottom-width:2px;border-left-width:2px}
.panel-corner.br{bottom:-1px;right:-1px;border-bottom-width:2px;border-right-width:2px}

.panel-header{
    padding:20px 24px;
    border-bottom:1px solid rgba(212,175,55,0.1);
    display:flex;align-items:center;justify-content:space-between;
}
.panel-title{
    font-family:'Orbitron',monospace;
    font-size:0.8rem;
    font-weight:500;
    letter-spacing:3px;
    text-transform:uppercase;
    color:var(--gold);
    display:flex;align-items:center;gap:12px;
}
.panel-title svg{width:18px;height:18px;opacity:0.8}
.panel-badge{
    font-family:'Orbitron',monospace;
    padding:5px 12px;
    background:var(--gold-dim);
    border:1px solid rgba(212,175,55,0.2);
    color:var(--gold);
    font-size:0.6rem;
    letter-spacing:2px;
}
.panel-body{flex:1;padding:24px;display:flex;flex-direction:column}

/* Upload Zone */
.upload-zone{
    flex:1;
    border:1px dashed rgba(212,175,55,0.25);
    background:repeating-linear-gradient(45deg,transparent,transparent 10px,rgba(212,175,55,0.02) 10px,rgba(212,175,55,0.02) 20px);
    display:flex;flex-direction:column;align-items:center;justify-content:center;
    cursor:pointer;
    transition:all 0.4s;
    position:relative;
    min-height:360px;
    overflow:hidden;
}
.upload-zone::before{
    content:'';position:absolute;inset:0;
    background:radial-gradient(circle at center,var(--gold-dim) 0%,transparent 70%);
    opacity:0;transition:opacity 0.4s;
}
.upload-zone:hover::before,.upload-zone.active::before{opacity:1}
.upload-zone:hover,.upload-zone.active{border-color:var(--gold);border-style:solid}
.upload-zone.has-image{border-style:solid;padding:0;background:var(--void)}

.upload-content{text-align:center;padding:40px;position:relative;z-index:1}
.upload-icon{
    width:80px;height:80px;margin:0 auto 24px;
    border:2px solid rgba(212,175,55,0.3);
    position:relative;
    display:flex;align-items:center;justify-content:center;
    transition:all 0.4s;
}
.upload-icon::before,.upload-icon::after{
    content:'';position:absolute;
    border:1px solid rgba(212,175,55,0.15);
}
.upload-icon::before{inset:6px}
.upload-icon::after{inset:12px}
.upload-zone:hover .upload-icon{
    border-color:var(--gold);
    transform:scale(1.05);
    box-shadow:0 0 40px var(--gold-dim);
}
.upload-icon svg{width:28px;height:28px;color:var(--gold)}

.upload-title{
    font-family:'Orbitron',monospace;
    font-size:1rem;
    font-weight:500;
    letter-spacing:2px;
    margin-bottom:10px;
}
.upload-hint{font-size:0.85rem;color:var(--silver);margin-bottom:20px}
.upload-formats{display:flex;gap:8px;justify-content:center}
.format-tag{
    font-family:'Orbitron',monospace;
    padding:4px 12px;
    background:var(--graphite);
    border:1px solid var(--steel);
    font-size:0.65rem;
    letter-spacing:1px;
    color:var(--silver);
}

/* Preview */
.preview-wrap{width:100%;height:100%;position:relative;display:none}
.preview-wrap.show{display:block}
.preview-img{width:100%;height:100%;object-fit:contain;background:var(--void)}
.preview-bar{
    position:absolute;bottom:0;left:0;right:0;
    padding:16px 20px;
    background:linear-gradient(transparent,rgba(0,0,0,0.95));
    display:flex;align-items:center;justify-content:space-between;
}
.preview-name{
    font-size:0.85rem;
    white-space:nowrap;overflow:hidden;text-overflow:ellipsis;
    max-width:70%;
}
.preview-change{
    font-family:'Orbitron',monospace;
    padding:8px 16px;
    background:var(--gold);
    border:none;
    color:var(--void);
    font-size:0.65rem;
    letter-spacing:1px;
    cursor:pointer;
    transition:all 0.3s;
}
.preview-change:hover{background:var(--gold-bright)}

/* Actions */
.actions{margin-top:20px;display:flex;gap:12px}
.btn{
    flex:1;
    font-family:'Orbitron',monospace;
    padding:16px 24px;
    font-size:0.75rem;
    font-weight:500;
    letter-spacing:2px;
    text-transform:uppercase;
    border:none;
    cursor:pointer;
    transition:all 0.3s;
    display:flex;align-items:center;justify-content:center;gap:10px;
    position:relative;
    overflow:hidden;
}
.btn svg{width:16px;height:16px}
.btn-primary{
    background:linear-gradient(135deg,var(--gold) 0%,#c9a227 100%);
    color:var(--void);
}
.btn-primary::before{
    content:'';position:absolute;inset:0;
    background:linear-gradient(135deg,var(--gold-bright) 0%,var(--gold) 100%);
    opacity:0;transition:opacity 0.3s;
}
.btn-primary:hover::before{opacity:1}
.btn-primary:hover{transform:translateY(-2px);box-shadow:0 10px 30px rgba(212,175,55,0.3)}
.btn-primary:disabled{opacity:0.4;cursor:not-allowed;transform:none;box-shadow:none}
.btn-primary span,.btn-primary svg{position:relative;z-index:1}

.btn-ghost{
    background:transparent;
    border:1px solid rgba(212,175,55,0.3);
    color:var(--gold);
}
.btn-ghost:hover{background:var(--gold-dim);border-color:var(--gold)}

/* Result Panel */
.result-empty{
    flex:1;display:flex;flex-direction:column;
    align-items:center;justify-content:center;
    text-align:center;padding:40px;
}
.result-empty-icon{
    width:100px;height:100px;margin-bottom:24px;
    border:1px solid var(--steel);
    display:flex;align-items:center;justify-content:center;
    position:relative;
}
.result-empty-icon::before{content:'';position:absolute;inset:8px;border:1px solid rgba(212,175,55,0.1)}
.result-empty-icon svg{width:36px;height:36px;color:var(--steel)}
.result-empty p{font-size:0.9rem;color:var(--silver)}

.result-content{display:none;flex-direction:column;flex:1}
.result-content.show{display:flex}

.result-image-wrap{
    flex:1;position:relative;
    background:var(--void);
    border:1px solid rgba(212,175,55,0.1);
    min-height:300px;
    overflow:hidden;
}
.result-img{width:100%;height:100%;object-fit:contain}

/* Loading */
.loading{
    position:absolute;inset:0;
    background:rgba(3,3,3,0.95);
    display:none;align-items:center;justify-content:center;
    flex-direction:column;gap:20px;z-index:10;
}
.loading.show{display:flex}
.scanner{
    width:120px;height:120px;
    border:2px solid var(--gold);
    position:relative;
    animation:pulse 2s ease-in-out infinite;
}
.scanner::before{
    content:'';position:absolute;
    top:0;left:0;right:0;height:2px;
    background:linear-gradient(90deg,transparent,var(--gold),transparent);
    animation:scan 1.5s ease-in-out infinite;
}
@keyframes pulse{0%,100%{opacity:0.5}50%{opacity:1}}
@keyframes scan{0%{top:0}100%{top:calc(100% - 2px)}}
.loading-text{
    font-family:'Orbitron',monospace;
    font-size:0.75rem;
    letter-spacing:3px;
    color:var(--gold);
    animation:blink 1s step-end infinite;
}
@keyframes blink{50%{opacity:0.5}}

/* Result Summary */
.result-summary{
    margin-top:20px;
    padding:20px;
    background:var(--obsidian);
    border:1px solid rgba(212,175,55,0.1);
}
.summary-row{
    display:flex;align-items:center;justify-content:space-between;
    padding-bottom:16px;margin-bottom:16px;
    border-bottom:1px solid rgba(255,255,255,0.05);
}
.summary-status{display:flex;align-items:center;gap:14px}
.status-indicator{
    width:48px;height:48px;
    display:flex;align-items:center;justify-content:center;
    position:relative;
}
.status-indicator::before{
    content:'';position:absolute;inset:0;
    border:2px solid currentColor;opacity:0.2;
}
.status-indicator.pass{color:var(--success)}
.status-indicator.fail{color:var(--danger)}
.status-indicator svg{width:24px;height:24px}
.status-label{
    font-family:'Orbitron',monospace;
    font-size:1.1rem;font-weight:600;letter-spacing:2px;
}
.status-label.pass{color:var(--success)}
.status-label.fail{color:var(--danger)}
.summary-time{font-size:0.75rem;color:var(--silver);font-family:'Orbitron',monospace;letter-spacing:1px}

.defect-list{display:flex;flex-direction:column;gap:8px}
.defect-item{
    display:flex;align-items:center;justify-content:space-between;
    padding:12px 14px;
    background:rgba(255,71,87,0.08);
    border-left:2px solid var(--danger);
}
.defect-name{font-size:0.85rem;display:flex;align-items:center;gap:10px}
.defect-dot{width:6px;height:6px;background:var(--danger);border-radius:50%}
.defect-conf{
    font-family:'Orbitron',monospace;
    font-size:0.75rem;color:var(--gold);letter-spacing:1px;
}
.no-defect{
    text-align:center;padding:20px;
    color:var(--success);font-size:0.9rem;
    background:rgba(0,255,136,0.05);
    border:1px solid rgba(0,255,136,0.1);
}

/* Result Actions */
.result-actions{margin-top:16px;display:flex;gap:10px}
.action-btn{
    flex:1;
    font-family:'Orbitron',monospace;
    padding:12px;
    background:transparent;
    border:1px solid rgba(212,175,55,0.2);
    color:var(--gold);
    font-size:0.65rem;
    letter-spacing:1px;
    cursor:pointer;
    transition:all 0.3s;
    display:flex;align-items:center;justify-content:center;gap:8px;
}
.action-btn svg{width:14px;height:14px}
.action-btn:hover{background:var(--gold);color:var(--void)}

input[type="file"]{display:none}

/* Hero Title */
.hero-title{
    padding:100px 40px 20px;
    text-align:center;
    position:relative;
    z-index:1;
}
.title-en{
    font-family:'Orbitron',monospace;
    font-size:3.5rem;
    font-weight:700;
    letter-spacing:12px;
    color:var(--ivory);
    text-shadow:0 0 60px rgba(212,175,55,0.3);
    margin-bottom:8px;
    background:linear-gradient(135deg,var(--ivory) 0%,var(--gold) 50%,var(--ivory) 100%);
    background-size:200% auto;
    -webkit-background-clip:text;
    -webkit-text-fill-color:transparent;
    background-clip:text;
    animation:shimmer 4s linear infinite;
}
.title-en span{
    background:linear-gradient(135deg,var(--gold) 0%,var(--gold-bright) 50%,var(--gold) 100%);
    background-size:200% auto;
    -webkit-background-clip:text;
    -webkit-text-fill-color:transparent;
    background-clip:text;
}
@keyframes shimmer{to{background-position:200% center}}
.title-cn{
    font-family:'Rajdhani','Microsoft YaHei',sans-serif;
    font-size:1.1rem;
    font-weight:400;
    letter-spacing:8px;
    color:var(--silver);
    text-transform:uppercase;
}
.title-line{
    width:120px;height:1px;
    background:linear-gradient(90deg,transparent,var(--gold),transparent);
    margin:16px auto 0;
}

/* Adjust main padding */
.main{padding-top:20px}
</style>
</head>
<body>
<nav>
    <a href="/" class="logo">
        <div class="logo-icon">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5">
                <circle cx="12" cy="12" r="3"/>
                <path d="M12 1v4m0 14v4M4.22 4.22l2.83 2.83m9.9 9.9l2.83 2.83M1 12h4m14 0h4M4.22 19.78l2.83-2.83m9.9-9.9l2.83-2.83"/>
            </svg>
        </div>
        <div class="logo-text">ACSR<span>VISION</span></div>
    </a>
    <div class="nav-links">
        <a href="/detect" class="nav-link active">单张检测</a>
        <a href="/batch" class="nav-link">批量检测</a>
        <a href="/3d" class="nav-link">3D展示</a>
        <a href="/" class="nav-link">首页</a>
    </div>
</nav>

<div class="hero-title">
    <div class="title-en">ACSR<span>VISION</span></div>
    <div class="title-cn">钢芯铝绞线智能质检系统</div>
    <div class="title-line"></div>
</div>

<main class="main">
    <div class="panel">
        <div class="panel-corner tl"></div>
        <div class="panel-corner tr"></div>
        <div class="panel-corner bl"></div>
        <div class="panel-corner br"></div>
        <div class="panel-header">
            <div class="panel-title">
                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5"><rect x="3" y="3" width="18" height="18" rx="2"/><circle cx="8.5" cy="8.5" r="1.5"/><path d="M21 15l-5-5L5 21"/></svg>
                IMAGE INPUT
            </div>
            <span class="panel-badge">AI READY</span>
        </div>
        <div class="panel-body">
            <div class="upload-zone" id="uploadZone">
                <div class="upload-content" id="uploadContent">
                    <div class="upload-icon">
                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5">
                            <path d="M21 15v4a2 2 0 01-2 2H5a2 2 0 01-2-2v-4"/>
                            <polyline points="17 8 12 3 7 8"/>
                            <line x1="12" y1="3" x2="12" y2="15"/>
                        </svg>
                    </div>
                    <div class="upload-title">DROP IMAGE HERE</div>
                    <div class="upload-hint">或点击选择文件上传检测</div>
                    <div class="upload-formats">
                        <span class="format-tag">JPG</span>
                        <span class="format-tag">PNG</span>
                        <span class="format-tag">WEBP</span>
                    </div>
                </div>
                <div class="preview-wrap" id="previewWrap">
                    <img id="previewImg" class="preview-img" alt="Preview">
                    <div class="preview-bar">
                        <span class="preview-name" id="previewName"></span>
                        <button class="preview-change" onclick="changeImg(event)">CHANGE</button>
                    </div>
                </div>
            </div>
            <input type="file" id="fileInput" accept="image/*" hidden>
            <div class="actions">
                <button class="btn btn-primary" id="detectBtn" disabled onclick="runDetect()">
                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="11" cy="11" r="8"/><path d="M21 21l-4.35-4.35"/></svg>
                    <span>START SCAN</span>
                </button>
                <button class="btn btn-ghost" onclick="clearAll()">
                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M3 6h18M19 6v14a2 2 0 01-2 2H7a2 2 0 01-2-2V6m3 0V4a2 2 0 012-2h4a2 2 0 012 2v2"/></svg>
                    <span>CLEAR</span>
                </button>
            </div>
        </div>
    </div>

    <div class="panel">
        <div class="panel-corner tl"></div>
        <div class="panel-corner tr"></div>
        <div class="panel-corner bl"></div>
        <div class="panel-corner br"></div>
        <div class="panel-header">
            <div class="panel-title">
                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5"><path d="M9 11l3 3L22 4"/><path d="M21 12v7a2 2 0 01-2 2H5a2 2 0 01-2-2V5a2 2 0 012-2h11"/></svg>
                ANALYSIS RESULT
            </div>
        </div>
        <div class="panel-body">
            <div class="result-empty" id="resultEmpty">
                <div class="result-empty-icon">
                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1">
                        <path d="M14.5 4h-5L7 7H4a2 2 0 00-2 2v9a2 2 0 002 2h16a2 2 0 002-2V9a2 2 0 00-2-2h-3l-2.5-3z"/>
                        <circle cx="12" cy="13" r="3"/>
                    </svg>
                </div>
                <p>上传图片启动AI智能检测</p>
            </div>
            <div class="result-content" id="resultContent">
                <div class="result-image-wrap">
                    <img id="resultImg" class="result-img" alt="Result">
                    <div class="loading" id="loading">
                        <div class="scanner"></div>
                        <div class="loading-text">ANALYZING...</div>
                    </div>
                </div>
                <div class="result-summary" id="resultSummary"></div>
                <div class="result-actions" id="resultActions"></div>
            </div>
        </div>
    </div>
</main>

<script>
let currentFile = null;
let currentResult = null;

const uploadZone = document.getElementById('uploadZone');
const fileInput = document.getElementById('fileInput');
const detectBtn = document.getElementById('detectBtn');
const uploadContent = document.getElementById('uploadContent');
const previewWrap = document.getElementById('previewWrap');

uploadZone.addEventListener('click', e => {
    if (!e.target.closest('.preview-change')) fileInput.click();
});
uploadZone.addEventListener('dragover', e => { e.preventDefault(); uploadZone.classList.add('active'); });
uploadZone.addEventListener('dragleave', () => uploadZone.classList.remove('active'));
uploadZone.addEventListener('drop', e => {
    e.preventDefault();
    uploadZone.classList.remove('active');
    if (e.dataTransfer.files[0]) loadFile(e.dataTransfer.files[0]);
});
fileInput.addEventListener('change', e => { if (e.target.files[0]) loadFile(e.target.files[0]); });

function loadFile(file) {
    if (!file.type.startsWith('image/')) return alert('请上传图片文件');
    currentFile = file;
    const reader = new FileReader();
    reader.onload = e => {
        document.getElementById('previewImg').src = e.target.result;
        document.getElementById('previewName').textContent = file.name;
        uploadContent.style.display = 'none';
        previewWrap.classList.add('show');
        uploadZone.classList.add('has-image');
        detectBtn.disabled = false;
    };
    reader.readAsDataURL(file);
}

function changeImg(e) { e.stopPropagation(); fileInput.click(); }

function clearAll() {
    currentFile = null; currentResult = null;
    fileInput.value = '';
    uploadContent.style.display = 'block';
    previewWrap.classList.remove('show');
    uploadZone.classList.remove('has-image');
    detectBtn.disabled = true;
    document.getElementById('resultEmpty').style.display = 'flex';
    document.getElementById('resultContent').classList.remove('show');
}

async function runDetect() {
    if (!currentFile) return;
    detectBtn.disabled = true;
    document.getElementById('resultEmpty').style.display = 'none';
    document.getElementById('resultContent').classList.add('show');
    document.getElementById('loading').classList.add('show');
    
    const formData = new FormData();
    formData.append('image', currentFile);
    
    try {
        const res = await fetch('/detect', { method: 'POST', body: formData });
        const data = await res.json();
        if (data.success) { currentResult = data; renderResult(data); }
        else alert('检测失败: ' + (data.error || '未知错误'));
    } catch (err) { alert('检测失败: ' + err.message); }
    
    document.getElementById('loading').classList.remove('show');
    detectBtn.disabled = false;
}

function renderResult(data) {
    document.getElementById('resultImg').src = data.result_image;
    const isPass = data.conclusion === '合格';
    const summaryHtml = `
        <div class="summary-row">
            <div class="summary-status">
                <div class="status-indicator ${isPass ? 'pass' : 'fail'}">
                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        ${isPass ? '<path d="M20 6L9 17l-5-5"/>' : '<circle cx="12" cy="12" r="10"/><path d="M15 9l-6 6M9 9l6 6"/>'}
                    </svg>
                </div>
                <span class="status-label ${isPass ? 'pass' : 'fail'}">${data.conclusion}</span>
            </div>
            <span class="summary-time">${new Date().toLocaleString('zh-CN')}</span>
        </div>
        <div class="defect-list">
            ${data.detections.length > 0 
                ? data.detections.map(d => `
                    <div class="defect-item">
                        <span class="defect-name"><span class="defect-dot"></span>${d.class_name}</span>
                        <span class="defect-conf">${d.confidence}%</span>
                    </div>`).join('')
                : '<div class="no-defect">未检测到缺陷，产品质量合格</div>'}
        </div>`;
    document.getElementById('resultSummary').innerHTML = summaryHtml;
    
    document.getElementById('resultActions').innerHTML = `
        <button class="action-btn" onclick="window.open('${data.result_image}','_blank')">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M15 3h6v6M9 21H3v-6M21 3l-7 7M3 21l7-7"/></svg>
            VIEW
        </button>
        <button class="action-btn" onclick="downloadImg()">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M21 15v4a2 2 0 01-2 2H5a2 2 0 01-2-2v-4M7 10l5 5 5-5M12 15V3"/></svg>
            DOWNLOAD
        </button>
        <button class="action-btn" onclick="genReport()">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M14 2H6a2 2 0 00-2 2v16a2 2 0 002 2h12a2 2 0 002-2V8z"/><path d="M14 2v6h6M16 13H8M16 17H8M10 9H8"/></svg>
            REPORT
        </button>`;
}

function downloadImg() {
    if (!currentResult) return;
    const a = document.createElement('a');
    a.href = currentResult.result_image;
    a.download = 'acsr_detection_result.png';
    a.click();
}

async function genReport() {
    if (!currentResult) return;
    try {
        const res = await fetch('/report/pdf', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({ detections: currentResult.detections, result_image: currentResult.result_image })
        });
        const data = await res.json();
        if (data.success) window.open(data.url, '_blank');
        else alert('报告生成失败');
    } catch (e) { alert('报告生成失败: ' + e.message); }
}
</script>
</body>
</html>
